<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المنصة التعليمية المتطورة - نظام الإدارة المتكامل</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.14.0/index.min.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.14.0/index.min.js"></script>
    <style>
        /* CSS المدمج */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #4cc9f0;
            --danger-color: #f72585;
            --warning-color: #f8961e;
            --info-color: #4895ef;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --border-color: #dee2e6;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            color: var(--dark-color);
        }

        /* شاشة الترحيب */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            color: white;
        }

        .welcome-content {
            text-align: center;
            max-width: 600px;
            padding: 2rem;
        }

        .welcome-logo .logo-icon.large {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: white;
        }

        .welcome-logo h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .welcome-logo p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        .welcome-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .feature {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .feature:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }

        .feature i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        /* الأزرار */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.4);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .btn-block {
            width: 100%;
        }

        /* الهيدر */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: var(--dark-color);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .logo-text {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .logo-subtitle {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .nav {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: var(--dark-color);
            border-radius: var(--border-radius);
            transition: var(--transition);
            position: relative;
        }

        .nav-item:hover,
        .nav-item.active {
            background: var(--primary-color);
            color: white;
        }

        .nav-item-badge {
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -5px;
            left: -5px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-name {
            font-weight: 600;
        }

        .user-role {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
        }

        /* المحتوى الرئيسي */
        .main-content {
            margin-top: 80px;
            min-height: calc(100vh - 80px);
            padding: 2rem;
            max-width: 1400px;
            margin-right: auto;
            margin-left: auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .section-title i {
            color: var(--primary-color);
        }

        /* نظام الدردشة */
        .chat-container {
            display: flex;
            height: calc(100vh - 200px);
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .chat-sidebar {
            width: 350px;
            border-left: 1px solid var(--border-color);
            background: var(--light-color);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        .chat-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-search {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .chat-search input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
        }

        .conversations-list {
            flex: 1;
            overflow-y: auto;
        }

        .conversation-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .conversation-item:hover,
        .conversation-item.active {
            background: white;
            border-right: 3px solid var(--primary-color);
        }

        .conversation-avatar {
            width: 50px;
            height: 50px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .conversation-avatar.small {
            width: 40px;
            height: 40px;
            font-size: 0.9rem;
        }

        .conversation-info {
            flex: 1;
        }

        .conversation-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .conversation-last-message {
            font-size: 0.9rem;
            opacity: 0.7;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-meta {
            text-align: left;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.25rem;
        }

        .conversation-time {
            font-size: 0.8rem;
            opacity: 0.6;
        }

        .conversation-unread {
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .empty-chat {
            text-align: center;
            color: var(--gray-color);
            margin-top: 3rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .empty-chat i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .message {
            display: flex;
            max-width: 70%;
            gap: 0.5rem;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.sent {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message.received {
            align-self: flex-start;
        }

        .message-content {
            background: white;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            max-width: 100%;
        }

        .message.sent .message-content {
            background: var(--primary-color);
            color: white;
        }

        .message-text {
            margin-bottom: 0.25rem;
            word-wrap: break-word;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        .message-status {
            display: flex;
            align-items: flex-end;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .chat-input-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            background: white;
        }

        .chat-input-tools {
            display: flex;
            gap: 0.5rem;
        }

        .chat-tool-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--gray-color);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .chat-tool-btn:hover {
            background: var(--light-color);
            color: var(--primary-color);
        }

        .chat-input-wrapper {
            flex: 1;
        }

        .chat-input-wrapper input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
            resize: none;
            transition: var(--transition);
        }

        .chat-input-wrapper input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .send-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn:hover {
            background: var(--secondary-color);
            transform: scale(1.05);
        }

        .emoji-picker-container {
            position: absolute;
            bottom: 80px;
            left: 20px;
            display: none;
            z-index: 10;
        }

        .emoji-picker-container.active {
            display: block;
        }

        /* القصص */
        .stories-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding: 1rem 0;
        }

        .story-item {
            flex: 0 0 auto;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .story-item:hover {
            transform: scale(1.05);
        }

        .story-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f72585, #4361ee);
            padding: 3px;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.5rem;
        }

        .story-author {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .story-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
        }

        .story-viewer.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .story-close {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1001;
        }

        .story-content {
            position: relative;
            width: 350px;
            height: 600px;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .story-progress {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 1001;
        }

        .story-progress-bar {
            flex: 1;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .story-progress-fill {
            height: 100%;
            background: white;
            width: 0%;
        }

        #currentStoryImage {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .story-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            padding: 1.5rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .story-author-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .story-author-name {
            font-weight: 600;
        }

        .story-time {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .story-nav {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            opacity: 0.7;
            transition: var(--transition);
        }

        .story-nav:hover {
            opacity: 1;
        }

        .story-nav.prev {
            right: 0;
        }

        .story-nav.next {
            left: 0;
        }

        /* الشبكات */
        .groups-grid,
        .channels-grid,
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .group-card,
        .channel-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
        }

        .group-card:hover,
        .channel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .group-header,
        .channel-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
        }

        .group-avatar,
        .channel-avatar {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 1rem;
        }

        .group-header h3,
        .channel-header h3 {
            margin-bottom: 0.5rem;
            font-size: 1.3rem;
        }

        .group-info,
        .channel-info {
            padding: 1.5rem;
        }

        .group-stats,
        .channel-stats {
            display: flex;
            justify-content: space-around;
            margin: 1rem 0;
            padding: 1rem 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }

        .group-stat,
        .channel-stat {
            text-align: center;
        }

        .group-stat-number,
        .channel-stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .group-stat-label,
        .channel-stat-label {
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-top: 0.25rem;
        }

        /* الوسائط */
        .media-item {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            aspect-ratio: 16/9;
            cursor: pointer;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .media-item i {
            font-size: 3rem;
            color: var(--gray-color);
        }

        .media-type {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .media-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            color: white;
            padding: 1rem;
            transform: translateY(100%);
            transition: var(--transition);
        }

        .media-item:hover .media-overlay {
            transform: translateY(0);
        }

        .media-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        /* النماذج */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        /* شريط الأدوات السريع */
        .quick-actions-bar {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            gap: 1rem;
            z-index: 90;
            transition: var(--transition);
            opacity: 0;
            visibility: hidden;
        }

        .quick-actions-bar.active {
            opacity: 1;
            visibility: visible;
        }

        .quick-action {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--gray-color);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .quick-action:hover {
            background: var(--light-color);
            color: var(--primary-color);
        }

        /* الزر العائم */
        .floating-action-btn {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(67, 97, 238, 0.4);
            transition: var(--transition);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-action-btn:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }

        /* حالة الاتصال */
        .connection-status {
            position: fixed;
            top: 1rem;
            left: 1rem;
            background: rgba(76, 201, 240, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 99;
        }

        /* إشعار التحديث */
        .update-notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 99;
            max-width: 400px;
        }

        .update-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .update-info {
            display: flex;
            flex-direction: column;
        }

        .update-info strong {
            color: var(--dark-color);
        }

        .update-info span {
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        /* القائمة المتنقلة */
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 200;
            transition: var(--transition);
            padding: 2rem 1rem;
            overflow-y: auto;
        }

        .mobile-menu.active {
            right: 0;
        }

        .mobile-nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 150;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        /* الصفحة الرئيسية */
        .home-hero {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4rem 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 3rem;
        }

        .hero-content h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .hero-content p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .hero-actions {
            display: flex;
            gap: 1rem;
        }

        .hero-image {
            font-size: 8rem;
            opacity: 0.8;
        }

        .features-section {
            padding: 2rem 0;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .feature-card {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .feature-card p {
            color: var(--gray-color);
            line-height: 1.6;
        }

        /* لوحة التحكم */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .stat-label {
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        .recent-activities {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 2rem;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-item i {
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .activity-content p {
            margin: 0;
            color: var(--dark-color);
        }

        .activity-time {
            font-size: 0.8rem;
            color: var(--gray-color);
        }

        /* المصادقة */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 70vh;
        }

        .auth-card {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-header h2 {
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        .auth-header p {
            color: var(--gray-color);
        }

        .auth-form {
            margin-bottom: 1.5rem;
        }

        .auth-footer {
            text-align: center;
        }

        .auth-footer a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* الرؤوس */
        .stories-header,
        .groups-header,
        .channels-header,
        .media-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        /* التجاوب */
        @media (max-width: 768px) {
            .header-content {
                padding: 1rem;
            }

            .nav {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }

            .chat-container {
                height: calc(100vh - 120px);
            }

            .chat-sidebar {
                position: absolute;
                left: 0;
                top: 0;
                height: 100%;
                width: 100%;
                z-index: 10;
                transform: translateX(-100%);
            }

            .chat-sidebar.active {
                transform: translateX(0);
            }

            .chat-toggle {
                display: block;
            }

            .main-content {
                padding: 1rem;
                margin-top: 70px;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .message {
                max-width: 85%;
            }

            .groups-grid,
            .channels-grid,
            .media-grid {
                grid-template-columns: 1fr;
            }

            .hero-content h1 {
                font-size: 2rem;
            }

            .hero-image {
                font-size: 4rem;
            }

            .home-hero {
                flex-direction: column;
                text-align: center;
                gap: 2rem;
            }

            .hero-actions {
                justify-content: center;
            }

            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            .floating-action-btn {
                bottom: 1rem;
                left: 1rem;
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .quick-actions-bar {
                bottom: 1rem;
                padding: 0.5rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .welcome-content {
                padding: 1rem;
            }

            .welcome-logo h1 {
                font-size: 2rem;
            }

            .welcome-features {
                grid-template-columns: 1fr;
            }

            .story-content {
                width: 100%;
                height: 100%;
                border-radius: 0;
            }

            .modal-content {
                width: 95%;
                margin: 1rem;
            }
        }

        /* تأثيرات متقدمة */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-in-right {
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* تحسينات الوصول */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* تحسينات الأداء */
        .will-change-transform {
            will-change: transform;
        }

        /* تحسينات الطباعة */
        @media print {
            .header,
            .floating-action-btn,
            .quick-actions-bar {
                display: none !important;
            }

            .main-content {
                margin-top: 0;
            }

            body {
                background: white !important;
            }
        }
    </style>
</head>
<body>
    <!-- شاشة الترحيب -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-content">
            <div class="welcome-logo">
                <i class="fas fa-graduation-cap logo-icon large"></i>
                <h1>المنصة التعليمية المتطورة</h1>
                <p>نظام إدارة تعليمي متكامل للتواصل والتعلم</p>
            </div>
            <div class="welcome-features">
                <div class="feature">
                    <i class="fas fa-comments"></i>
                    <span>دردشة فورية</span>
                </div>
                <div class="feature">
                    <i class="fas fa-users"></i>
                    <span>مجموعات تعليمية</span>
                </div>
                <div class="feature">
                    <i class="fas fa-video"></i>
                    <span>قنوات بث مباشر</span>
                </div>
                <div class="feature">
                    <i class="fas fa-share"></i>
                    <span>قصص تفاعلية</span>
                </div>
            </div>
            <button class="btn btn-primary btn-lg" onclick="hideWelcomeScreen()">
                <i class="fas fa-rocket"></i>
                ابدأ الآن
            </button>
        </div>
    </div>

    <!-- الهيدر -->
    <header class="header">
        <div class="header-content">
            <a href="#" class="logo" onclick="showPage('home')">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div>
                    <div class="logo-text">المنصة التعليمية</div>
                    <div class="logo-subtitle">نظام الإدارة المتكامل</div>
                </div>
            </a>

            <nav class="nav">
                <a href="#" class="nav-item" onclick="showPage('home')">
                    <i class="fas fa-home"></i>
                    الرئيسية
                </a>
                <a href="#" class="nav-item" onclick="showPage('chat')">
                    <i class="fas fa-comments"></i>
                    الدردشة
                    <span class="nav-item-badge">3</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('groups')">
                    <i class="fas fa-users"></i>
                    المجموعات
                </a>
                <a href="#" class="nav-item" onclick="showPage('channels')">
                    <i class="fas fa-video"></i>
                    القنوات
                </a>
                <a href="#" class="nav-item" onclick="showPage('media')">
                    <i class="fas fa-photo-video"></i>
                    الوسائط
                </a>
            </nav>

            <div class="user-info">
                <div class="user-avatar">م</div>
                <div>
                    <div class="user-name">محمد أحمد</div>
                    <div class="user-role">طالب</div>
                </div>
            </div>

            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- القائمة المتنقلة -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-nav">
            <a href="#" class="nav-item" onclick="showPage('home')">
                <i class="fas fa-home"></i>
                الرئيسية
            </a>
            <a href="#" class="nav-item" onclick="showPage('chat')">
                <i class="fas fa-comments"></i>
                الدردشة
                <span class="nav-item-badge">3</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('groups')">
                <i class="fas fa-users"></i>
                المجموعات
            </a>
            <a href="#" class="nav-item" onclick="showPage('channels')">
                <i class="fas fa-video"></i>
                القنوات
            </a>
            <a href="#" class="nav-item" onclick="showPage('media')">
                <i class="fas fa-photo-video"></i>
                الوسائط
            </a>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="toggleMobileMenu()"></div>

    <!-- المحتوى الرئيسي -->
    <main class="main-content">
        <!-- الصفحة الرئيسية -->
        <div class="page active" id="homePage">
            <div class="home-hero">
                <div class="hero-content">
                    <h1>مرحباً بك في المنصة التعليمية</h1>
                    <p>منصة متكاملة للتعلم والتفاعل مع زملائك ومعلميك في بيئة تعليمية آمنة ومتقدمة</p>
                    <div class="hero-actions">
                        <button class="btn btn-primary" onclick="showPage('chat')">
                            <i class="fas fa-comments"></i>
                            ابدأ الدردشة
                        </button>
                        <button class="btn btn-outline">
                            <i class="fas fa-play-circle"></i>
                            شاهد الفيديو التعريفي
                        </button>
                    </div>
                </div>
                <div class="hero-image">
                    <i class="fas fa-graduation-cap"></i>
                </div>
            </div>

            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div>
                        <div class="stat-number">1,247</div>
                        <div class="stat-label">طالب نشط</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div>
                        <div class="stat-number">48</div>
                        <div class="stat-label">معلم</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div>
                        <div class="stat-number">892</div>
                        <div class="stat-label">رسالة اليوم</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div>
                        <div class="stat-number">156</div>
                        <div class="stat-label">مادة تعليمية</div>
                    </div>
                </div>
            </div>

            <div class="features-section">
                <h2 class="section-title">
                    <i class="fas fa-star"></i>
                    المميزات الرئيسية
                </h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3>دردشة فورية</h3>
                        <p>تواصل فوري مع زملائك ومعلميك في بيئة آمنة ومخصصة للتعليم</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>مجموعات تعليمية</h3>
                        <p>انضم إلى مجموعات الدراسة وناقش المواضيع التعليمية مع زملائك</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <h3>بث مباشر</h3>
                        <p>حضور الدروس المباشرة والتفاعل مع المعلمين في الوقت الحقيقي</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- صفحة الدردشة -->
        <div class="page" id="chatPage">
            <h2 class="section-title">
                <i class="fas fa-comments"></i>
                الدردشة
            </h2>

            <div class="chat-container">
                <div class="chat-sidebar" id="chatSidebar">
                    <div class="chat-header">
                        <h3>المحادثات</h3>
                        <button class="btn btn-sm btn-primary" onclick="showNewChatModal()">
                            <i class="fas fa-plus"></i>
                            جديد
                        </button>
                    </div>
                    <div class="chat-search">
                        <input type="text" placeholder="ابحث في المحادثات...">
                    </div>
                    <div class="conversations-list" id="conversationsList">
                        <!-- سيتم ملؤها بالبيانات -->
                    </div>
                </div>

                <div class="chat-main">
                    <div class="chat-messages" id="chatMessages">
                        <div class="empty-chat">
                            <i class="fas fa-comments"></i>
                            <h3>اختر محادثة لبدء الدردشة</h3>
                            <p>اختر من القائمة الجانبية أو ابدأ محادثة جديدة</p>
                        </div>
                    </div>
                    <div class="chat-input-container" id="chatInputContainer" style="display: none;">
                        <div class="chat-input-tools">
                            <button class="chat-tool-btn" onclick="toggleEmojiPicker()">
                                <i class="fas fa-smile"></i>
                            </button>
                            <button class="chat-tool-btn">
                                <i class="fas fa-paperclip"></i>
                            </button>
                        </div>
                        <div class="chat-input-wrapper">
                            <input type="text" id="messageInput" placeholder="اكتب رسالتك هنا..." onkeypress="handleMessageInput(event)">
                        </div>
                        <button class="send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="emoji-picker-container" id="emojiPickerContainer">
                        <emoji-picker></emoji-picker>
                    </div>
                </div>
            </div>
        </div>

        <!-- صفحة المجموعات -->
        <div class="page" id="groupsPage">
            <div class="groups-header">
                <h2 class="section-title">
                    <i class="fas fa-users"></i>
                    المجموعات التعليمية
                </h2>
                <button class="btn btn-primary" onclick="showCreateGroupModal()">
                    <i class="fas fa-plus"></i>
                    إنشاء مجموعة
                </button>
            </div>

            <div class="groups-grid" id="groupsGrid">
                <!-- سيتم ملؤها بالبيانات -->
            </div>
        </div>

        <!-- صفحة القنوات -->
        <div class="page" id="channelsPage">
            <div class="channels-header">
                <h2 class="section-title">
                    <i class="fas fa-video"></i>
                    القنوات التعليمية
                </h2>
                <button class="btn btn-primary" onclick="showCreateChannelModal()">
                    <i class="fas fa-plus"></i>
                    إنشاء قناة
                </button>
            </div>

            <div class="channels-grid" id="channelsGrid">
                <!-- سيتم ملؤها بالبيانات -->
            </div>
        </div>

        <!-- صفحة الوسائط -->
        <div class="page" id="mediaPage">
            <div class="media-header">
                <h2 class="section-title">
                    <i class="fas fa-photo-video"></i>
                    الوسائط المشتركة
                </h2>
            </div>

            <div class="media-grid" id="mediaGrid">
                <!-- سيتم ملؤها بالبيانات -->
            </div>
        </div>
    </main>

    <!-- الأزرار العائمة -->
    <button class="floating-action-btn" onclick="toggleQuickActions()">
        <i class="fas fa-plus"></i>
    </button>

    <div class="quick-actions-bar" id="quickActionsBar">
        <button class="quick-action" onclick="showNewChatModal()">
            <i class="fas fa-comment"></i>
        </button>
        <button class="quick-action" onclick="showCreateGroupModal()">
            <i class="fas fa-users"></i>
        </button>
        <button class="quick-action" onclick="showCreateChannelModal()">
            <i class="fas fa-video"></i>
        </button>
        <button class="quick-action">
            <i class="fas fa-share"></i>
        </button>
    </div>

    <!-- حالة الاتصال -->
    <div class="connection-status" id="connectionStatus">
        <i class="fas fa-wifi"></i>
        <span>متصل بالخادم</span>
    </div>

    <!-- النماذج المنبثقة -->
    <!-- نموذج إنشاء محادثة جديدة -->
    <div class="modal" id="newChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>بدء محادثة جديدة</h3>
                <button class="modal-close" onclick="closeModal('newChatModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ابحث عن مستخدم</label>
                    <input type="text" placeholder="اكتب اسم المستخدم...">
                </div>
                <div class="form-group">
                    <label>المستخدمون المتاحون</label>
                    <div id="availableUsersList">
                        <!-- قائمة المستخدمين -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-outline" onclick="closeModal('newChatModal')">إلغاء</button>
                    <button class="btn btn-primary">بدء المحادثة</button>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج إنشاء مجموعة -->
    <div class="modal" id="createGroupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>إنشاء مجموعة جديدة</h3>
                <button class="modal-close" onclick="closeModal('createGroupModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>اسم المجموعة</label>
                    <input type="text" placeholder="أدخل اسم المجموعة...">
                </div>
                <div class="form-group">
                    <label>وصف المجموعة</label>
                    <textarea placeholder="أدخل وصف المجموعة..." rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>إضافة أعضاء</label>
                    <input type="text" placeholder="ابحث عن أعضاء...">
                </div>
                <div class="modal-actions">
                    <button class="btn btn-outline" onclick="closeModal('createGroupModal')">إلغاء</button>
                    <button class="btn btn-primary">إنشاء المجموعة</button>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج إنشاء قناة -->
    <div class="modal" id="createChannelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>إنشاء قناة جديدة</h3>
                <button class="modal-close" onclick="closeModal('createChannelModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>اسم القناة</label>
                    <input type="text" placeholder="أدخل اسم القناة...">
                </div>
                <div class="form-group">
                    <label>وصف القناة</label>
                    <textarea placeholder="أدخل وصف القناة..." rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>نوع القناة</label>
                    <select>
                        <option value="public">عامة</option>
                        <option value="private">خاصة</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-outline" onclick="closeModal('createChannelModal')">إلغاء</button>
                    <button class="btn btn-primary">إنشاء القناة</button>
                </div>
            </div>
        </div>
    </div>

    <!-- مشغل القصص -->
    <div class="story-viewer" id="storyViewer">
        <button class="story-close" onclick="closeStoryViewer()">
            <i class="fas fa-times"></i>
        </button>
        <div class="story-content">
            <div class="story-progress" id="storyProgress">
                <!-- سيتم ملؤها ديناميكياً -->
            </div>
            <img id="currentStoryImage" src="" alt="Story">
            <div class="story-info">
                <div class="story-author-avatar" id="storyAuthorAvatar">م</div>
                <div>
                    <div class="story-author-name" id="storyAuthorName">محمد أحمد</div>
                    <div class="story-time" id="storyTime">منذ ساعة</div>
                </div>
            </div>
            <div class="story-nav prev" onclick="prevStory()">
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="story-nav next" onclick="nextStory()">
                <i class="fas fa-chevron-left"></i>
            </div>
        </div>
    </div>

    <!-- JavaScript المدمج -->
    <script>
        // بيانات التطبيق
        let currentUser = {
            id: 1,
            name: 'محمد أحمد',
            role: 'طالب',
            avatar: 'م'
        };

        let conversations = [
            {
                id: 1,
                name: 'مجموعة الرياضيات',
                type: 'group',
                avatar: 'ر',
                lastMessage: 'أحمد: هل فهمتم التمرين؟',
                time: '10:30',
                unread: 2,
                online: true
            },
            {
                id: 2,
                name: 'أحمد محمد',
                type: 'private',
                avatar: 'أ',
                lastMessage: 'شكراً على المساعدة',
                time: '09:15',
                unread: 0,
                online: true
            },
            {
                id: 3,
                name: 'مجموعة الفيزياء',
                type: 'group',
                avatar: 'ف',
                lastMessage: 'سارة: المحاضرة ممتازة',
                time: 'أمس',
                unread: 5,
                online: false
            }
        ];

        let groups = [
            {
                id: 1,
                name: 'مجموعة الرياضيات المتقدمة',
                description: 'مجموعة لدراسة الرياضيات المتقدمة وحل المسائل',
                avatar: 'ر',
                members: 24,
                online: 8,
                isPublic: true
            },
            {
                id: 2,
                name: 'نادي البرمجة',
                description: 'مجموعة لمحبي البرمجة وتطوير التطبيقات',
                avatar: 'ب',
                members: 45,
                online: 12,
                isPublic: true
            },
            {
                id: 3,
                name: 'مجموعة اللغة الإنجليزية',
                description: 'لممارسة اللغة الإنجليزية وتحسين المهارات',
                avatar: 'إ',
                members: 32,
                online: 5,
                isPublic: false
            }
        ];

        let channels = [
            {
                id: 1,
                name: 'قناة الرياضيات',
                description: 'بث مباشر لدروس الرياضيات',
                avatar: 'ر',
                subscribers: 150,
                isLive: true,
                isPublic: true
            },
            {
                id: 2,
                name: 'قناة البرمجة',
                description: 'دروس برمجة وتطوير مشاريع',
                avatar: 'ب',
                subscribers: 89,
                isLive: false,
                isPublic: true
            },
            {
                id: 3,
                name: 'قناة العلوم',
                description: 'تجارب علمية ومحاضرات',
                avatar: 'ع',
                subscribers: 67,
                isLive: true,
                isPublic: false
            }
        ];

        let stories = [
            {
                id: 1,
                author: 'أحمد محمد',
                avatar: 'أ',
                time: 'منذ ساعة',
                image: 'https://via.placeholder.com/350x600/667eea/white?text=قصة+تعليمية',
                duration: 5000
            },
            {
                id: 2,
                author: 'سارة أحمد',
                avatar: 'س',
                time: 'منذ 3 ساعات',
                image: 'https://via.placeholder.com/350x600/f72585/white?text=تجربة+علمية',
                duration: 5000
            }
        ];

        // حالة التطبيق
        let currentPage = 'home';
        let currentConversation = null;
        let currentStoryIndex = 0;
        let storyInterval = null;

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadInitialData();
        });

        function initializeApp() {
            // تهيئة Socket.IO
            const socket = io({
                auth: {
                    token: localStorage.getItem('authToken') || generateToken()
                }
            });

            // تخزين السوكت في النطاق العام
            window.socket = socket;

            // إعداد معالجات الأحداث
            socket.on('connect', () => {
                updateConnectionStatus(true);
                console.log('متصل بالخادم بنجاح');
            });

            socket.on('disconnect', () => {
                updateConnectionStatus(false);
                console.log('انقطع الاتصال بالخادم');
            });

            socket.on('new_message', (message) => {
                handleNewMessage(message);
            });

            socket.on('user_online', (user) => {
                updateUserStatus(user.id, true);
            });

            socket.on('user_offline', (user) => {
                updateUserStatus(user.id, false);
            });

            // تهيئة منتقي الإيموجي
            const picker = document.querySelector('emoji-picker');
            picker.addEventListener('emoji-click', event => {
                const input = document.getElementById('messageInput');
                input.value += event.detail.unicode;
                input.focus();
            });
        }

        function setupEventListeners() {
            // إعداد مستمعي الأحداث العامة
            window.addEventListener('online', () => {
                showNotification('تم استعادة الاتصال بالإنترنت', 'success');
            });

            window.addEventListener('offline', () => {
                showNotification('فقدان الاتصال بالإنترنت', 'error');
            });

            // إغلاق النماذج بالضغط على ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAllModals();
                    closeStoryViewer();
                }
            });
        }

        function loadInitialData() {
            loadConversations();
            loadGroups();
            loadChannels();
            loadStories();
            loadMedia();
        }

        // وظائف إدارة الصفحات
        function showPage(pageName) {
            // إخفاء جميع الصفحات
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // إظهار الصفحة المطلوبة
            document.getElementById(pageName + 'Page').classList.add('active');
            currentPage = pageName;

            // إغلاق القائمة المتنقلة إذا كانت مفتوحة
            toggleMobileMenu(false);

            // تحديث العنوان في المتصفح
            document.title = getPageTitle(pageName) + ' - المنصة التعليمية';
        }

        function getPageTitle(pageName) {
            const titles = {
                home: 'الرئيسية',
                chat: 'الدردشة',
                groups: 'المجموعات',
                channels: 'القنوات',
                media: 'الوسائط'
            };
            return titles[pageName] || 'المنصة التعليمية';
        }

        // وظائف شاشة الترحيب
        function hideWelcomeScreen() {
            const welcomeScreen = document.getElementById('welcomeScreen');
            welcomeScreen.style.opacity = '0';
            setTimeout(() => {
                welcomeScreen.style.display = 'none';
            }, 500);
        }

        // وظائف الدردشة
        function loadConversations() {
            const container = document.getElementById('conversationsList');
            container.innerHTML = '';

            conversations.forEach(conversation => {
                const conversationElement = document.createElement('div');
                conversationElement.className = 'conversation-item';
                conversationElement.onclick = () => selectConversation(conversation.id);

                conversationElement.innerHTML = `
                    <div class="conversation-avatar ${conversation.online ? 'online' : ''}">
                        ${conversation.avatar}
                    </div>
                    <div class="conversation-info">
                        <div class="conversation-name">${conversation.name}</div>
                        <div class="conversation-last-message">${conversation.lastMessage}</div>
                    </div>
                    <div class="conversation-meta">
                        <div class="conversation-time">${conversation.time}</div>
                        ${conversation.unread > 0 ? 
                            `<div class="conversation-unread">${conversation.unread}</div>` : 
                            ''
                        }
                    </div>
                `;

                container.appendChild(conversationElement);
            });
        }

        function selectConversation(conversationId) {
            currentConversation = conversations.find(c => c.id === conversationId);
            
            // تحديث الواجهة
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelectorAll('.conversation-item')[conversations.findIndex(c => c.id === conversationId)].classList.add('active');

            // إظهار شريط الإدخال
            document.getElementById('chatInputContainer').style.display = 'flex';
            
            // تحميل الرسائل
            loadMessages(conversationId);
        }

        function loadMessages(conversationId) {
            const container = document.getElementById('chatMessages');
            
            // رسائل تجريبية
            const messages = [
                {
                    id: 1,
                    text: 'مرحباً بالجميع!',
                    time: '10:25',
                    sender: { id: 2, name: 'أحمد محمد' },
                    isSent: false
                },
                {
                    id: 2,
                    text: 'أهلاً وسهلاً! كيف الحال؟',
                    time: '10:26',
                    sender: { id: 1, name: 'محمد أحمد' },
                    isSent: true
                },
                {
                    id: 3,
                    text: 'هل يمكن مساعدتي في حل التمرين الثالث؟',
                    time: '10:28',
                    sender: { id: 2, name: 'أحمد محمد' },
                    isSent: false
                }
            ];

            container.innerHTML = '';
            messages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${message.isSent ? 'sent' : 'received'}`;
                
                messageElement.innerHTML = `
                    <div class="message-avatar">
                        <div class="conversation-avatar small">${message.sender.name.charAt(0)}</div>
                    </div>
                    <div class="message-content">
                        <div class="message-text">${message.text}</div>
                        <div class="message-time">${message.time}</div>
                    </div>
                    ${message.isSent ? '<div class="message-status"><i class="fas fa-check"></i></div>' : ''}
                `;

                container.appendChild(messageElement);
            });

            // التمرير للأسفل
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (message && currentConversation) {
                // إرسال الرسالة عبر السوكت
                if (window.socket) {
                    window.socket.emit('send_message', {
                        conversationId: currentConversation.id,
                        text: message,
                        sender: currentUser
                    });
                }

                // إضافة الرسالة للواجهة مباشرة
                const container = document.getElementById('chatMessages');
                const messageElement = document.createElement('div');
                messageElement.className = 'message sent';
                
                messageElement.innerHTML = `
                    <div class="message-avatar">
                        <div class="conversation-avatar small">${currentUser.avatar}</div>
                    </div>
                    <div class="message-content">
                        <div class="message-text">${message}</div>
                        <div class="message-time">الآن</div>
                    </div>
                    <div class="message-status"><i class="fas fa-check"></i></div>
                `;

                container.appendChild(messageElement);
                input.value = '';

                // التمرير للأسفل
                container.scrollTop = container.scrollHeight;
            }
        }

        function handleMessageInput(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function handleNewMessage(message) {
            if (message.conversationId === currentConversation?.id) {
                const container = document.getElementById('chatMessages');
                const messageElement = document.createElement('div');
                messageElement.className = 'message received';
                
                messageElement.innerHTML = `
                    <div class="message-avatar">
                        <div class="conversation-avatar small">${message.sender.name.charAt(0)}</div>
                    </div>
                    <div class="message-content">
                        <div class="message-text">${message.text}</div>
                        <div class="message-time">الآن</div>
                    </div>
                `;

                container.appendChild(messageElement);
                container.scrollTop = container.scrollHeight;
            }
        }

        // وظائف المجموعات
        function loadGroups() {
            const container = document.getElementById('groupsGrid');
            container.innerHTML = '';

            groups.forEach(group => {
                const groupElement = document.createElement('div');
                groupElement.className = 'group-card';
                
                groupElement.innerHTML = `
                    <div class="group-header">
                        <div class="group-avatar">${group.avatar}</div>
                        <h3>${group.name}</h3>
                        <p>${group.description}</p>
                    </div>
                    <div class="group-info">
                        <div class="group-stats">
                            <div class="group-stat">
                                <div class="group-stat-number">${group.members}</div>
                                <div class="group-stat-label">أعضاء</div>
                            </div>
                            <div class="group-stat">
                                <div class="group-stat-number">${group.online}</div>
                                <div class="group-stat-label">متصل الآن</div>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-block" onclick="joinGroup(${group.id})">
                            <i class="fas fa-sign-in-alt"></i>
                            ${group.isPublic ? 'انضم للمجموعة' : 'طلب الانضمام'}
                        </button>
                    </div>
                `;

                container.appendChild(groupElement);
            });
        }

        function joinGroup(groupId) {
            const group = groups.find(g => g.id === groupId);
            if (group) {
                showNotification(`تم ${group.isPublic ? 'الانضمام' : 'إرسال طلب الانضمام'} إلى ${group.name}`, 'success');
            }
        }

        // وظائف القنوات
        function loadChannels() {
            const container = document.getElementById('channelsGrid');
            container.innerHTML = '';

            channels.forEach(channel => {
                const channelElement = document.createElement('div');
                channelElement.className = 'channel-card';
                
                channelElement.innerHTML = `
                    <div class="channel-header">
                        <div class="channel-avatar">${channel.avatar}</div>
                        <h3>${channel.name}</h3>
                        <p>${channel.description}</p>
                        ${channel.isLive ? '<div class="live-badge"><i class="fas fa-broadcast-tower"></i> بث مباشر</div>' : ''}
                    </div>
                    <div class="channel-info">
                        <div class="channel-stats">
                            <div class="channel-stat">
                                <div class="channel-stat-number">${channel.subscribers}</div>
                                <div class="channel-stat-label">مشترك</div>
                            </div>
                        </div>
                        <button class="btn ${channel.isPublic ? 'btn-primary' : 'btn-outline'} btn-block" onclick="subscribeChannel(${channel.id})">
                            <i class="fas fa-bell"></i>
                            ${channel.isPublic ? 'اشترك في القناة' : 'طلب الاشتراك'}
                        </button>
                    </div>
                `;

                container.appendChild(channelElement);
            });
        }

        function subscribeChannel(channelId) {
            const channel = channels.find(c => c.id === channelId);
            if (channel) {
                showNotification(`تم ${channel.isPublic ? 'الاشتراك' : 'إرسال طلب الاشتراك'} في ${channel.name}`, 'success');
            }
        }

        // وظائف الوسائط
        function loadMedia() {
            const container = document.getElementById('mediaGrid');
            container.innerHTML = '';

            const mediaItems = [
                { type: 'image', title: 'شرح الرياضيات', icon: 'fas fa-image' },
                { type: 'video', title: 'درس الفيزياء', icon: 'fas fa-video' },
                { type: 'document', title: 'ملخص التاريخ', icon: 'fas fa-file-pdf' },
                { type: 'audio', title: 'محاضرة اللغة', icon: 'fas fa-music' }
            ];

            mediaItems.forEach((media, index) => {
                const mediaElement = document.createElement('div');
                mediaElement.className = 'media-item';
                
                mediaElement.innerHTML = `
                    <i class="${media.icon}"></i>
                    <div class="media-type">${getMediaTypeText(media.type)}</div>
                    <div class="media-overlay">
                        <h4>${media.title}</h4>
                        <div class="media-actions">
                            <button class="btn btn-sm btn-outline">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-sm btn-primary">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>
                `;

                container.appendChild(mediaElement);
            });
        }

        function getMediaTypeText(type) {
            const types = {
                image: 'صورة',
                video: 'فيديو',
                document: 'ملف',
                audio: 'صوت'
            };
            return types[type] || 'ملف';
        }

        // وظائف القصص
        function loadStories() {
            // سيتم تنفيذها لاحقاً
        }

        function openStoryViewer(storyIndex) {
            currentStoryIndex = storyIndex;
            const story = stories[storyIndex];
            
            document.getElementById('storyAuthorAvatar').textContent = story.avatar;
            document.getElementById('storyAuthorName').textContent = story.author;
            document.getElementById('storyTime').textContent = story.time;
            document.getElementById('currentStoryImage').src = story.image;
            
            // إعداد شريط التقدم
            setupStoryProgress();
            
            document.getElementById('storyViewer').classList.add('active');
            startStoryTimer();
        }

        function closeStoryViewer() {
            document.getElementById('storyViewer').classList.remove('active');
            clearInterval(storyInterval);
        }

        function setupStoryProgress() {
            const container = document.getElementById('storyProgress');
            container.innerHTML = '';
            
            stories.forEach((story, index) => {
                const progressBar = document.createElement('div');
                progressBar.className = 'story-progress-bar';
                
                const progressFill = document.createElement('div');
                progressFill.className = 'story-progress-fill';
                progressFill.style.width = index === currentStoryIndex ? '0%' : '0%';
                
                progressBar.appendChild(progressFill);
                container.appendChild(progressBar);
            });
        }

        function startStoryTimer() {
            const currentStory = stories[currentStoryIndex];
            const progressFill = document.querySelectorAll('.story-progress-fill')[currentStoryIndex];
            
            let width = 0;
            const duration = currentStory.duration;
            const interval = 50;
            const increment = (interval / duration) * 100;
            
            clearInterval(storyInterval);
            
            storyInterval = setInterval(() => {
                width += increment;
                progressFill.style.width = width + '%';
                
                if (width >= 100) {
                    nextStory();
                }
            }, interval);
        }

        function nextStory() {
            if (currentStoryIndex < stories.length - 1) {
                currentStoryIndex++;
                openStoryViewer(currentStoryIndex);
            } else {
                closeStoryViewer();
            }
        }

        function prevStory() {
            if (currentStoryIndex > 0) {
                currentStoryIndex--;
                openStoryViewer(currentStoryIndex);
            }
        }

        // وظائف النماذج المنبثقة
        function showNewChatModal() {
            showModal('newChatModal');
        }

        function showCreateGroupModal() {
            showModal('createGroupModal');
        }

        function showCreateChannelModal() {
            showModal('createChannelModal');
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }

        // وظائف متنوعة
        function toggleMobileMenu(show) {
            const menu = document.getElementById('mobileMenu');
            const overlay = document.getElementById('overlay');
            
            if (show === undefined) {
                show = !menu.classList.contains('active');
            }
            
            if (show) {
                menu.classList.add('active');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                menu.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function toggleQuickActions() {
            const bar = document.getElementById('quickActionsBar');
            bar.classList.toggle('active');
        }

        function toggleEmojiPicker() {
            const picker = document.getElementById('emojiPickerContainer');
            picker.classList.toggle('active');
        }

        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.innerHTML = '<i class="fas fa-wifi"></i><span>متصل بالخادم</span>';
                status.style.background = 'rgba(76, 201, 240, 0.9)';
            } else {
                status.innerHTML = '<i class="fas fa-wifi-slash"></i><span>انقطع الاتصال</span>';
                status.style.background = 'rgba(247, 37, 133, 0.9)';
            }
        }

        function updateUserStatus(userId, online) {
            // تحديث حالة المستخدم في القوائم
            const conversation = conversations.find(c => c.id === userId);
            if (conversation) {
                conversation.online = online;
                loadConversations();
            }
        }

        function showNotification(message, type = 'info') {
            // إنشاء إشعار مؤقت
            const notification = document.createElement('div');
            notification.className = `update-notification ${type}`;
            notification.innerHTML = `
                <div class="update-content">
                    <i class="fas fa-${getNotificationIcon(type)}"></i>
                    <div class="update-info">
                        <strong>${getNotificationTitle(type)}</strong>
                        <span>${message}</span>
                    </div>
                </div>
                <button class="modal-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(notification);
            
            // إزالة الإشعار تلقائياً بعد 5 ثواني
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function getNotificationIcon(type) {
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            return icons[type] || 'info-circle';
        }

        function getNotificationTitle(type) {
            const titles = {
                success: 'نجاح',
                error: 'خطأ',
                warning: 'تحذير',
                info: 'معلومة'
            };
            return titles[type] || 'إشعار';
        }

        function generateToken() {
            // توليد توكن مؤقت (في التطبيق الحقيقي يجب أن يأتي من الخادم)
            const token = 'temp_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('authToken', token);
            return token;
        }

        // جعل الدوال متاحة عالمياً
        window.showPage = showPage;
        window.hideWelcomeScreen = hideWelcomeScreen;
        window.selectConversation = selectConversation;
        window.sendMessage = sendMessage;
        window.handleMessageInput = handleMessageInput;
        window.joinGroup = joinGroup;
        window.subscribeChannel = subscribeChannel;
        window.showNewChatModal = showNewChatModal;
        window.showCreateGroupModal = showCreateGroupModal;
        window.showCreateChannelModal = showCreateChannelModal;
        window.closeModal = closeModal;
        window.toggleMobileMenu = toggleMobileMenu;
        window.toggleQuickActions = toggleQuickActions;
        window.toggleEmojiPicker = toggleEmojiPicker;
        window.openStoryViewer = openStoryViewer;
        window.closeStoryViewer = closeStoryViewer;
        window.nextStory = nextStory;
        window.prevStory = prevStory;
    </script>
</body>
</html>
